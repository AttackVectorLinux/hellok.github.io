<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>helloworld</title>
	<meta name="description" content="">
	<meta name="author" content="hellok">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="/theme/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/local.css" rel="stylesheet">
	<link href="/theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->

</head>
<body>
<a href="http://github.com/hellok/hellok.github.io"><img style="position: absolute; top: 39px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="/">helloworld</a>
			<ul class="nav">
					<li ><a href="/category/ctf.html">ctf</a></li>
					<li class="active"><a href="/category/note.html">note</a></li>
			</ul>
			<p class="pull-right"><a href="/archives.html">[archives]</a> <a href="/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="http://getpelican.com/">Pelican</a></li>
				<li><a href="http://python.org/">Python.org</a></li>
				<li><a href="http://maps.google.com">maps</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="http://github.com/hellok">github</a></li>
				<li><a href="http://repro.sinaapp.com">sinaapp</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>Chromebook development env</h1></div>
		<div class="well small">Permalink: <a class="more" href="/chromebook-development-env">2013-10-05 00:00:00</a>
by <a class="url fn" href="/author/hellok">hellok </a>
 in <a href="/category/note.html">note</a>
</div>
<h2>开启开发者模式:</h2>
按住ESC和Refresh刷新键的同时，按开关键，即可进入恢复模式里，在这里继续按Ctrl+D（一闪而过，一定要迅速，速度！）然后它会让你确认是否重启并进入开发模式。如果要通过U盘启动，那么需要先输入“crossystem dev_boot_usb=1”，重启之后按Ctrl+U。

如果想离开开发模式回到正常状态，可以输入“crossystem disable_dev_request=1; reboot”。
<h2>

Login with the admin user.
Open a terminal by hiting CTRL+ALT+T
Type the following
shell (to drop into a standard bash shell)
sudo stop powerm - to disable sleep when lid is closed. You could go with the longer version of: sudo initctl stop powerm but there is no reason to type more…
sudo stop powerd - to disable all other power management features.
Now logout from the menu – But do not restart!

https://github.com/triune/caffeine</br>http://www.chromeexperiments.com/detail/eye-texture-raytracer/</h2>


		<div><h2>网络</h2>
<p>在chromebook上上网有多种方案。这里推荐2种: </p>
<h6>方法1:</h6>
<p>安装python
sudo dev_install
然后安装goagent就好了</p>
<h6>方法2:</h6>
<p>利用ssh通道
在chromebook上需要做的
1.ctrl + alt + t打开shell 
2.ssh
3.host 192.168.2.1;user hellok;dynamic-forward 8801;nocmd;connect</p>
<p>在主机上需要做的就简单多了。goagent开启ssh代理就ok了。</p>
<h2>开发环境</h2>
<p>推荐XFCE,需要先打开开发者模式
可以如下命令查看更多环境,根据个人喜好了</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">e</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">crouton</span> <span class="o">-</span><span class="n">t</span> <span class="n">help</span>
<span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">e</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">crouton</span> <span class="o">-</span><span class="n">t</span> <span class="n">unity</span>
<span class="n">sudo</span> <span class="n">startunity</span> <span class="o">-</span><span class="n">b</span>
</pre></div>


<div class="highlight"><pre><span class="n">Available</span> <span class="n">targets</span><span class="o">:</span>
<span class="n">audio</span>
<span class="n">Support</span> <span class="n">audio</span> <span class="n">playback</span> <span class="n">via</span> <span class="n">Chromium</span> <span class="n">OS</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">audio</span> <span class="n">system</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">core</span>
<span class="n">chrome</span>
<span class="n">Google</span> <span class="n">Chrome</span> <span class="n">browser</span><span class="p">,</span> <span class="n">stable</span> <span class="n">channel</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">chrome</span><span class="o">-</span><span class="n">beta</span>
<span class="n">Google</span> <span class="n">Chrome</span> <span class="n">browser</span><span class="p">,</span> <span class="n">beta</span> <span class="n">channel</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">chrome</span><span class="o">-</span><span class="n">dev</span>
<span class="n">Google</span> <span class="n">Chrome</span> <span class="n">browser</span><span class="p">,</span> <span class="n">dev</span> <span class="n">channel</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">chromium</span>
<span class="n">Chromium</span> <span class="n">browser</span><span class="p">.</span> <span class="n">Uses</span> <span class="n">the</span> <span class="n">distro</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">version</span><span class="p">,</span> <span class="n">which</span> <span class="n">may</span> <span class="n">be</span> <span class="n">old</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">cinnamon</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">Cinnamon</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">300</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">cli</span><span class="o">-</span><span class="n">extra</span>
<span class="n">Basic</span> <span class="n">CLI</span> <span class="n">tools</span> <span class="n">such</span> <span class="n">as</span> <span class="n">wget</span> <span class="n">and</span> <span class="n">ssh</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">core</span>
<span class="n">core</span>
<span class="n">Performs</span> <span class="n">core</span> <span class="n">system</span> <span class="n">configuration</span><span class="p">.</span> <span class="n">Most</span> <span class="n">users</span> <span class="n">would</span> <span class="n">want</span> <span class="n">this</span><span class="p">.</span>
<span class="n">e17</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">enlightenment</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">50</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">gnome</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">GNOME</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">400</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">GTK</span><span class="o">-</span><span class="n">based</span> <span class="n">tools</span> <span class="n">including</span> <span class="n">gdebi</span><span class="p">,</span> <span class="n">gksu</span><span class="p">,</span> <span class="n">and</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">browser</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">kde</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">KDE</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">800</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">keyboard</span>
<span class="n">Adds</span> <span class="n">support</span> <span class="k">for</span> <span class="n">Chromebook</span> <span class="n">keyboard</span> <span class="n">special</span> <span class="n">keys</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">lxde</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">LXDE</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">200</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">touch</span>
<span class="n">Touchscreen</span> <span class="n">and</span> <span class="n">limited</span> <span class="n">generic</span> <span class="n">gesture</span> <span class="n">support</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">unity</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">Unity</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">700</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
<span class="n">x11</span>
<span class="n">Basic</span> <span class="n">X11</span> <span class="n">install</span><span class="p">.</span> <span class="n">Does</span> <span class="n">not</span> <span class="n">install</span> <span class="n">any</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">core</span> <span class="n">audio</span>
<span class="n">xbmc</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">XBMC</span> <span class="n">media</span> <span class="n">player</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">140</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">x11</span>
<span class="n">xephyr</span>
<span class="n">Nested</span> <span class="n">X11</span> <span class="n">install</span><span class="p">.</span> <span class="n">Replaces</span> <span class="n">X11</span> <span class="k">if</span> <span class="n">specified</span> <span class="n">first</span><span class="p">.</span>
<span class="nl">Requires:</span> <span class="n">core</span> <span class="n">audio</span>
<span class="n">xfce</span>
<span class="n">Installs</span> <span class="n">the</span> <span class="n">Xfce</span> <span class="n">desktop</span> <span class="n">environment</span><span class="p">.</span> <span class="p">(</span><span class="n">Approx</span><span class="p">.</span> <span class="mi">250</span><span class="n">MB</span><span class="p">)</span>
<span class="nl">Requires:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">extra</span>
</pre></div>


<h2>刷机</h2>
<p>chrubuntu或bodhi
方法类似,看下脚本:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># fw_type will always be developer for Mario.</span>
<span class="c"># Alex and ZGB need the developer BIOS installed though.</span>
<span class="nv">fw_type</span><span class="o">=</span><span class="s2">&quot;`crossystem mainfw_type`&quot;</span>
<span class="nv">currentimage</span><span class="o">=</span><span class="s2">&quot;bodhi-chromebook-rootfs-20130129.tar.xz&quot;</span>
<span class="nv">currentmd5</span><span class="o">=</span><span class="s2">&quot;371426f5c50890a1e6185b659a507de4&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! <span class="s2">&quot;$fw_type&quot;</span> <span class="o">=</span> <span class="s2">&quot;developer&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> -e <span class="s2">&quot;\nYou&#39;re Chromebook is not running a developer BIOS!&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;You need to run:&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;sudo chromeos-firmwareupdate --mode=todev&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;and then re-run this script.&quot;</span>
    <span class="k">return</span>
<span class="k">  else</span>
<span class="k">    </span><span class="nb">echo</span> -e <span class="s2">&quot;\nOh good. You&#39;re running a developer BIOS...\n&quot;</span>
<span class="k">fi</span>

<span class="c"># hwid lets us know if this is a Mario (Cr-48), Alex (Samsung Series 5), ZGB (Acer), etc</span>
<span class="nv">hwid</span><span class="o">=</span><span class="s2">&quot;`crossystem hwid`&quot;</span>

<span class="nb">echo</span> -e <span class="s2">&quot;Chome OS model is: $hwid\n&quot;</span>

<span class="nv">chromebook_arch</span><span class="o">=</span><span class="s2">&quot;`uname -m`&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! <span class="s2">&quot;$chromebook_arch&quot;</span> <span class="o">=</span> <span class="s2">&quot;armv7l&quot;</span> <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;This version of Bodhi Linux is for the ARM-based Chromebooks only\n&quot;</span>
<span class="k">else</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;and you&#39;re running on a ARM-based Chromebook, awesome!\n&quot;</span>
<span class="k">fi</span>

<span class="nb">read</span> -p <span class="s2">&quot;Press [Enter] to continue...&quot;</span>

<span class="nv">powerd_status</span><span class="o">=</span><span class="s2">&quot;`initctl status powerd`&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! <span class="s2">&quot;$powerd_status&quot;</span> <span class="o">=</span> <span class="s2">&quot;powerd stop/waiting&quot;</span> <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;Stopping powerd to keep display from timing out...&quot;</span>
  initctl stop powerd
<span class="k">fi</span>

<span class="nv">powerm_status</span><span class="o">=</span><span class="s2">&quot;`initctl status powerm`&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! <span class="s2">&quot;$powerm_status&quot;</span> <span class="o">=</span> <span class="s2">&quot;powerm stop/waiting&quot;</span> <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;Stopping powerm to keep display from timing out...&quot;</span>
  initctl stop powerm
<span class="k">fi</span>

setterm -blank 0

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">target_disk</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">echo</span> <span class="s2">&quot;Got ${target_disk} as target drive&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;WARNING! All data on this device will be wiped out! Continue at your own risk!&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">read</span> -p <span class="s2">&quot;Press [Enter] to install Bodhi on ${target_disk} or CTRL+C to quit&quot;</span>

  <span class="nv">ext_size</span><span class="o">=</span><span class="s2">&quot;`blockdev --getsz ${target_disk}`&quot;</span>
  <span class="nv">aroot_size</span><span class="o">=</span><span class="k">$((</span>ext_size <span class="o">-</span> <span class="m">65600</span> <span class="o">-</span> <span class="m">33</span><span class="k">))</span>
  parted --script <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span> <span class="s2">&quot;mktable gpt&quot;</span>
  cgpt create <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span> 
  cgpt add -i 6 -b 64 -s 32768 -S 1 -P 5 -l KERN-A -t <span class="s2">&quot;kernel&quot;</span> <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>
  cgpt add -i 7 -b 65600 -s <span class="nv">$aroot_size</span> -l ROOT-A -t <span class="s2">&quot;rootfs&quot;</span> <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>
  sync
  blockdev --rereadpt <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>
  partprobe <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>
  crossystem <span class="nv">dev_boot_usb</span><span class="o">=</span>1
<span class="k">else</span>
<span class="k">  </span><span class="nv">target_disk</span><span class="o">=</span><span class="s2">&quot;`rootdev -d -s`&quot;</span>
  <span class="c"># Do partitioning (if we haven&#39;t already)</span>
  <span class="nv">ckern_size</span><span class="o">=</span><span class="s2">&quot;`cgpt show -i 6 -n -s -q ${target_disk}`&quot;</span>
  <span class="nv">croot_size</span><span class="o">=</span><span class="s2">&quot;`cgpt show -i 7 -n -s -q ${target_disk}`&quot;</span>
  <span class="nv">state_size</span><span class="o">=</span><span class="s2">&quot;`cgpt show -i 1 -n -s -q ${target_disk}`&quot;</span>

  <span class="nv">max_ubuntu_size</span><span class="o">=</span><span class="k">$((</span><span class="nv">$state_size</span><span class="o">/</span><span class="m">1024</span><span class="o">/</span><span class="m">1024</span><span class="o">/</span><span class="m">2</span><span class="k">))</span>
  <span class="nv">rec_ubuntu_size</span><span class="o">=</span><span class="k">$((</span><span class="nv">$max_ubuntu_size</span> <span class="o">-</span> <span class="m">1</span><span class="k">))</span>
  <span class="c"># If KERN-C and ROOT-C are one, we partition, otherwise assume they&#39;re what they need to be...</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$ckern_size&quot;</span> <span class="o">=</span>  <span class="s2">&quot;1&quot;</span> -o <span class="s2">&quot;$croot_size&quot;</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
<span class="k">    while</span> :
    <span class="k">do</span>
<span class="k">      </span><span class="nb">read</span> -p <span class="s2">&quot;Enter the size in gigabytes you want to reserve for Bodhi. Acceptable range is 5 to $max_ubuntu_size  but $rec_ubuntu_size is the recommended maximum: &quot;</span> ubuntu_size
      <span class="k">if</span> <span class="o">[</span> ! <span class="nv">$ubuntu_size</span> -ne 0 2&gt;/dev/null <span class="o">]</span>
      <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> -e <span class="s2">&quot;\n\nNumbers only please...\n\n&quot;</span>
        <span class="k">continue</span>
<span class="k">      fi</span>
<span class="k">      if</span> <span class="o">[</span> <span class="nv">$ubuntu_size</span> -lt 5 -o <span class="nv">$ubuntu_size</span> -gt <span class="nv">$max_ubuntu_size</span> <span class="o">]</span>
      <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> -e <span class="s2">&quot;\n\nThat number is out of range. Enter a number 5 through $max_ubuntu_size\n\n&quot;</span>
        <span class="k">continue</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nb">break</span>
<span class="nb">    </span><span class="k">done</span>
    <span class="c"># We&#39;ve got our size in GB for ROOT-C so do the math...</span>

    <span class="c">#calculate sector size for rootc</span>
    <span class="nv">rootc_size</span><span class="o">=</span><span class="k">$((</span><span class="nv">$ubuntu_size</span><span class="o">*</span><span class="m">1024</span><span class="o">*</span><span class="m">1024</span><span class="o">*</span><span class="m">2</span><span class="k">))</span>

    <span class="c">#kernc is always 16mb</span>
    <span class="nv">kernc_size</span><span class="o">=</span>32768

    <span class="c">#new stateful size with rootc and kernc subtracted from original</span>
    <span class="nv">stateful_size</span><span class="o">=</span><span class="k">$((</span><span class="nv">$state_size</span> <span class="o">-</span> <span class="nv">$rootc_size</span> <span class="o">-</span> <span class="nv">$kernc_size</span><span class="k">))</span>

    <span class="c">#start stateful at the same spot it currently starts at</span>
    <span class="nv">stateful_start</span><span class="o">=</span><span class="s2">&quot;`cgpt show -i 1 -n -b -q ${target_disk}`&quot;</span>

    <span class="c">#start kernc at stateful start plus stateful size</span>
    <span class="nv">kernc_start</span><span class="o">=</span><span class="k">$((</span><span class="nv">$stateful_start</span> <span class="o">+</span> <span class="nv">$stateful_size</span><span class="k">))</span>

    <span class="c">#start rootc at kernc start plus kernc size</span>
    <span class="nv">rootc_start</span><span class="o">=</span><span class="k">$((</span><span class="nv">$kernc_start</span> <span class="o">+</span> <span class="nv">$kernc_size</span><span class="k">))</span>

    <span class="c">#Do the real work</span>

    <span class="nb">echo</span> -e <span class="s2">&quot;\n\nModifying partition table to make room for Bodhi.&quot;</span> 
    <span class="nb">echo</span> -e <span class="s2">&quot;Your Chromebook will reboot, wipe your data and then&quot;</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;you should re-run this script...&quot;</span>
    umount /mnt/stateful_partition

    <span class="c"># stateful first</span>
    cgpt add -i 1 -b <span class="nv">$stateful_start</span> -s <span class="nv">$stateful_size</span> -l STATE <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>

    <span class="c"># now kernc</span>
    cgpt add -i 6 -b <span class="nv">$kernc_start</span> -s <span class="nv">$kernc_size</span> -l KERN-C <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>

    <span class="c"># finally rootc</span>
    cgpt add -i 7 -b <span class="nv">$rootc_start</span> -s <span class="nv">$rootc_size</span> -l ROOT-C <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span>

    reboot
    <span class="nb">exit</span>
<span class="nb">  </span><span class="k">fi</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> ! -d /mnt/stateful_partition/bodhi <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span>mkdir /mnt/stateful_partition/bodhi
<span class="k">fi</span>

<span class="nb">cd</span> /mnt/stateful_partition/bodhi

<span class="c"># Download and copy bodhi root filesystem</span>
wget http://sourceforge.net/projects/bodhilinux/files/ARMHF/Chromebook/<span class="nv">$currentimage</span>

<span class="nv">md5</span><span class="o">=</span><span class="sb">`</span>md5sum <span class="nv">$currentimage</span> | awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="sb">`</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$md5&quot;</span> !<span class="o">=</span> <span class="s2">&quot;$currentmd5&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Bad check sum. Cleaning up files and exiting - please try again.&quot;</span>
    rm <span class="nv">$currentimage</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;${target_disk}&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;mmcblk&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
<span class="k">  </span><span class="nv">target_rootfs</span><span class="o">=</span><span class="s2">&quot;${target_disk}p7&quot;</span>
  <span class="nv">target_kern</span><span class="o">=</span><span class="s2">&quot;${target_disk}p6&quot;</span>
<span class="k">else</span>
<span class="k">  </span><span class="nv">target_rootfs</span><span class="o">=</span><span class="s2">&quot;${target_disk}7&quot;</span>
  <span class="nv">target_kern</span><span class="o">=</span><span class="s2">&quot;${target_disk}6&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;Target Kernel Partition: $target_kern  Target Root FS: ${target_rootfs}&quot;</span>

<span class="k">if</span> <span class="o">[</span> ! -d /tmp/urfs <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span>mkdir /tmp/urfs
<span class="k">fi</span>
mkfs.ext4 <span class="k">${</span><span class="nv">target_rootfs</span><span class="k">}</span>
mount -t ext4 <span class="k">${</span><span class="nv">target_rootfs</span><span class="k">}</span> /tmp/urfs

mv <span class="nv">$currentimage</span> /tmp/urfs/

<span class="nb">cd</span> /tmp/urfs

tar -Jxvf <span class="nv">$currentimage</span>
rm <span class="nv">$currentimage</span>

<span class="c">#Fix dbus permissions for removable storage</span>
wget http://sourceforge.net/projects/bodhilinux/files/ARMHF/Chromebook/chromebook-dbus.sh
chroot . bash chromebook-dbus.sh
rm chromebook-dbus.sh

rm -rf /tmp/urfs/lib/modules/*
rm -rf /tmp/urfs/lib/firmware/*
cp -ar /lib/modules/* /tmp/urfs/lib/modules/
cp -ar /lib/firmware/* /tmp/urfs/lib/firmware/

<span class="nb">cd</span>
umount /tmp/urfs

<span class="nb">echo</span> <span class="s2">&quot;console=tty1 debug verbose root=${target_rootfs} rootwait rw lsm.module_locking=0&quot;</span> &gt; /tmp/config
vbutil_kernel --pack /tmp/newkern <span class="se">\</span>
--keyblock /usr/share/vboot/devkeys/kernel.keyblock <span class="se">\</span>
--version 1 <span class="se">\</span>
--signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk <span class="se">\</span>
--config /tmp/config <span class="se">\</span>
--vmlinuz /boot/vmlinuz-<span class="sb">`</span>uname -r<span class="sb">`</span> <span class="se">\</span>
--arch arm

<span class="nb">echo</span> <span class="s2">&quot;Copying new kernel to $target_kern&quot;</span>
dd <span class="k">if</span><span class="o">=</span>/tmp/newkern <span class="nv">of</span><span class="o">=</span><span class="nv">$target_kern</span>

<span class="c">#Set Bodhi partition as top priority for booting</span>
cgpt add -i 6 -P 5 -T 1 <span class="k">${</span><span class="nv">target_disk</span><span class="k">}</span> 
reboot
</pre></div>
</td></tr></table>

<div class="highlight"><pre># fw_type will always be developer for Mario.
# Alex and ZGB need the developer BIOS installed though.
fw_type=&quot;`crossystem mainfw_type`&quot;
if [ ! &quot;<span class="nv">$fw_type</span>&quot; = &quot;developer&quot; ]
  then
    echo -e &quot;\nYou&#39;re Chromebook is not running a developer BIOS!&quot;
    echo -e &quot;You need to run:&quot;
    echo -e &quot;&quot;
    echo -e &quot;sudo chromeos-firmwareupdate --mode=todev&quot;
    echo -e &quot;&quot;
    echo -e &quot;and then re-run this script.&quot;
    return
  else
    echo -e &quot;\nOh good. You&#39;re running a developer BIOS...\n&quot;
fi

# hwid lets us know if this is a Mario (Cr-48), Alex (Samsung Series 5), ZGB (Acer), etc
hwid=&quot;`crossystem hwid`&quot;

echo -e &quot;Chome OS model is: <span class="nv">$hwid</span>\n&quot;

chromebook_arch=&quot;`uname -m`&quot;
if [ ! &quot;<span class="nv">$chromebook_arch</span>&quot; = &quot;armv7l&quot; ]
then
  echo -e &quot;This version of Chrome OS is for the ARM-based Chromebooks only\n&quot;
else
  echo -e &quot;and you&#39;re running on a ARM-based Chromebook, awesome!\n&quot;
fi

read -p &quot;Press [Enter] to continue...&quot;

powerd_status=&quot;`initctl status powerd`&quot;
if [ ! &quot;<span class="nv">$powerd_status</span>&quot; = &quot;powerd stop/waiting&quot; ]
then
  echo -e &quot;Stopping powerd to keep display from timing out...&quot;
  initctl stop powerd
fi

powerm_status=&quot;`initctl status powerm`&quot;
if [ ! &quot;<span class="nv">$powerm_status</span>&quot; = &quot;powerm stop/waiting&quot; ]
then
  echo -e &quot;Stopping powerm to keep display from timing out...&quot;
  initctl stop powerm
fi

setterm -blank 0

if [ &quot;$1&quot; != &quot;&quot; ]; then
  target_disk=$1
  echo &quot;Got <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span> as target drive&quot;
  echo &quot;&quot;
  echo &quot;WARNING! All data on this device will be wiped out! Continue at your own risk!&quot;
  echo &quot;&quot;
  read -p &quot;Press [Enter] to install ChrUbuntu on <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span> or CTRL+C to quit&quot;

  ext_size=&quot;`blockdev --getsz <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>`&quot;
  aroot_size=$((ext_size - 65600 - 33))
  parted --script <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span> &quot;mktable gpt&quot;
  cgpt create <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span> 
  cgpt add -i 6 -b 64 -s 32768 -S 1 -P 5 -l KERN-A -t &quot;kernel&quot; <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>
  cgpt add -i 7 -b 65600 -s <span class="nv">$aroot_size</span> -l ROOT-A -t &quot;rootfs&quot; <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>
  sync
  blockdev --rereadpt <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>
  partprobe <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>
  crossystem dev_boot_usb=1
else
  target_disk=&quot;`rootdev -d -s`&quot;
  # Do partitioning (if we haven&#39;t already)
  ckern_size=&quot;`cgpt show -i 6 -n -s -q <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>`&quot;
  croot_size=&quot;`cgpt show -i 7 -n -s -q <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>`&quot;
  state_size=&quot;`cgpt show -i 1 -n -s -q <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>`&quot;

  max_ubuntu_size=$((<span class="nv">$state_size</span>/1024/1024/2))
  rec_ubuntu_size=$((<span class="nv">$max_ubuntu_size</span> - 1))
  # If KERN-C and ROOT-C are one, we partition, otherwise assume they&#39;re what they need to be...
  if [ &quot;<span class="nv">$ckern_size</span>&quot; =  &quot;1&quot; -o &quot;<span class="nv">$croot_size</span>&quot; = &quot;1&quot; ]
  then
    while :
    do
      read -p &quot;Enter the size in gigabytes you want to reserve for Ubuntu. Acceptable range is 5 to <span class="nv">$max_ubuntu_size</span>  but <span class="nv">$rec_ubuntu_size</span> is the recommended maximum: &quot; ubuntu_size
      if [ ! <span class="nv">$ubuntu_size</span> -ne 0 2&gt;/dev/null ]
      then
        echo -e &quot;\n\nNumbers only please...\n\n&quot;
        continue
      fi
      if [ <span class="nv">$ubuntu_size</span> -lt 5 -o <span class="nv">$ubuntu_size</span> -gt <span class="nv">$max_ubuntu_size</span> ]
      then
        echo -e &quot;\n\nThat number is out of range. Enter a number 5 through <span class="nv">$max_ubuntu_size</span>\n\n&quot;
        continue
      fi
      break
    done
    # We&#39;ve got our size in GB for ROOT-C so do the math...

    #calculate sector size for rootc
    rootc_size=$((<span class="nv">$ubuntu_size</span>*1024*1024*2))

    #kernc is always 16mb
    kernc_size=32768

    #new stateful size with rootc and kernc subtracted from original
    stateful_size=$((<span class="nv">$state_size</span> - <span class="nv">$rootc_size</span> - <span class="nv">$kernc_size</span>))

    #start stateful at the same spot it currently starts at
    stateful_start=&quot;`cgpt show -i 1 -n -b -q <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>`&quot;

    #start kernc at stateful start plus stateful size
    kernc_start=$((<span class="nv">$stateful_start</span> + <span class="nv">$stateful_size</span>))

    #start rootc at kernc start plus kernc size
    rootc_start=$((<span class="nv">$kernc_start</span> + <span class="nv">$kernc_size</span>))

    #Do the real work

    echo -e &quot;\n\nModifying partition table to make room for Ubuntu.&quot; 
    echo -e &quot;Your Chromebook will reboot, wipe your data and then&quot;
    echo -e &quot;you should re-run this script...&quot;
    umount /mnt/stateful_partition

    # stateful first
    cgpt add -i 1 -b <span class="nv">$stateful_start</span> -s <span class="nv">$stateful_size</span> -l STATE <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>

    # now kernc
    cgpt add -i 6 -b <span class="nv">$kernc_start</span> -s <span class="nv">$kernc_size</span> -l KERN-C <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>

    # finally rootc
    cgpt add -i 7 -b <span class="nv">$rootc_start</span> -s <span class="nv">$rootc_size</span> -l ROOT-C <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>

    reboot
    exit
  fi
fi

if [ ! -d /mnt/stateful_partition/ubuntu ]
then
  mkdir /mnt/stateful_partition/ubuntu
fi

cd /mnt/stateful_partition/ubuntu

# try mounting a USB / SD Card if it&#39;s there...
if [ ! -d /tmp/usb_files ]
  then
    mkdir /tmp/usb_files
  fi
mount /dev/sda /tmp/usb_files &gt; /dev/null 2&gt;<span class="err">&amp;</span>1
mount /dev/sda1 /tmp/usb_files &gt; /dev/null 2&gt;<span class="err">&amp;</span>1

# Copy /tmp/usb_files/ubuntu (.sha1 and foo.6 files) to SSD if they&#39;re there
if [ -d /tmp/usb_files/ubuntu ]
  then
    cp -rf /tmp/usb_files/ubuntu/* /mnt/stateful_partition/ubuntu/
  fi

if [[ &quot;<span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>&quot; =~ &quot;mmcblk&quot; ]]
then
  target_rootfs=&quot;<span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>p7&quot;
  target_kern=&quot;<span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>p6&quot;
else
  target_rootfs=&quot;<span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>7&quot;
  target_kern=&quot;<span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span>6&quot;
fi

echo &quot;Target Kernel Partition: <span class="nv">$target_kern</span>  Target Root FS: <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span>&quot;

# Download and copy ubuntu root filesystem, keep track of successful parts so we can resume
SEEK=0
FILESIZE=102400
for one in a b
do
  for two in a b c d e f g h i j k l m n o p q r s t u v w x y z
  do
    # last file is smaller than the rest...
    if [ &quot;<span class="nv">$one$two</span>&quot; = &quot;bz&quot; ]
    then
      FILESIZE=20480
    fi
    FILENAME=&quot;ubuntu-1204-arm.bin<span class="nv">$one$two.bz2</span>&quot;
    correct_sha1_is_valid=0
    while [ <span class="nv">$correct_sha1_is_valid</span> -ne 1 ]
    do
      if [ ! -f /mnt/stateful_partition/ubuntu/<span class="nv">$FILENAME.sha1</span> ]
      then
        wget http://cr-48-ubuntu.googlecode.com/files/<span class="nv">$FILENAME.sha1</span>
      fi
      correct_sha1=`cat <span class="nv">$FILENAME.sha1</span> | awk &#39;{print $1}&#39;`
      correct_sha1_length=&quot;<span class="cp">${</span><span class="c">#correct_sha1</span><span class="cp">}</span>&quot;
      if [ &quot;<span class="nv">$correct_sha1_length</span>&quot; -eq &quot;40&quot; ]
      then
        correct_sha1_is_valid=1
      else
        rm <span class="nv">$FILENAME.sha1</span>
      fi
    done
    current_sha1=`dd if=<span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> bs=1024 skip=<span class="nv">$SEEK</span> count=<span class="nv">$FILESIZE</span> status=noxfer | sha1sum | awk &#39;{print $1}&#39;`
    if [ &quot;<span class="nv">$correct_sha1</span>&quot; = &quot;<span class="nv">$current_sha1</span>&quot; ]
      then
        echo &quot;<span class="nv">$correct_sha1</span> equals <span class="nv">$current_sha1</span> already written correctly...&quot;
        SEEK=$(( <span class="nv">$SEEK</span> + <span class="nv">$FILESIZE</span> ))
        continue
      else
        echo -e &quot;<span class="nv">$FILENAME</span> needs to be written because it&#39;s <span class="nv">$current_sha1</span> not <span class="nv">$correct_sha1</span>&quot;
    fi
    if [ -f /tmp/usb_files/<span class="nv">$FILENAME</span> ]
      then
        echo -e &quot;Found <span class="nv">$FILENAME</span> on flash drive. Using it...&quot;
        get_cmd=&quot;cat /tmp/usb_files/<span class="nv">$FILENAME</span>&quot;
      else
        echo -e &quot;\n\nDownloading <span class="nv">$FILENAME</span>\n\n&quot;
        get_cmd=&quot;wget -O - http://cr-48-ubuntu.googlecode.com/files/<span class="nv">$FILENAME</span>&quot;
      fi
    write_is_valid=0
    while [ <span class="nv">$write_is_valid</span> -ne 1 ]
      do
        <span class="nv">$get_cmd</span> | bunzip2 -c | dd bs=1024 seek=<span class="nv">$SEEK</span> of=<span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> status=noxfer &gt; /dev/null 2&gt;<span class="err">&amp;</span>1
        current_sha1=`dd if=<span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> bs=1024 skip=<span class="nv">$SEEK</span> count=<span class="nv">$FILESIZE</span> status=noxfer | sha1sum | awk &#39;{print $1}&#39;`
        if [ &quot;<span class="nv">$correct_sha1</span>&quot; = &quot;<span class="nv">$current_sha1</span>&quot; ]
          then
            echo -e &quot;\n<span class="nv">$FILENAME</span> was written to <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> correctly...\n\n&quot;
            write_is_valid=1
        else
          echo -e &quot;\nError writing downloaded file <span class="nv">$FILENAME.</span> shouldbe: <span class="nv">$correct_sha1</span> is:<span class="nv">$current_sha1.</span> Retrying...\n\n&quot;
        fi
      done
    SEEK=$(( <span class="nv">$SEEK</span> + <span class="nv">$FILESIZE</span> ))
  done
done

#Mount Ubuntu rootfs and copy cgpt + modules over
echo &quot;Copying modules, firmware and binaries to <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> for ChrUbuntu&quot;
if [ ! -d /tmp/urfs ]
then
  mkdir /tmp/urfs
fi
mount -t ext4 <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> /tmp/urfs
cp /usr/bin/cgpt /tmp/urfs/usr/bin/
chmod a+rx /tmp/urfs/usr/bin/cgpt
cp -ar /lib/modules/* /tmp/urfs/lib/modules/
cp -ar /lib/firmware/* /tmp/urfs/lib/firmware/
umount /tmp/urfs

echo &quot;console=tty1 debug verbose root=<span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> rootwait rw lsm.module_locking=0&quot; &gt; /tmp/config
vbutil_kernel --pack /tmp/newkern \
--keyblock /usr/share/vboot/devkeys/kernel.keyblock \
--version 1 \
--signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk \
--config /tmp/config \
--vmlinuz /boot/vmlinuz-`uname -r` \
--arch arm

echo &quot;Copying new kernel to <span class="nv">$target_kern</span>&quot;
dd if=/tmp/newkern of=<span class="nv">$target_kern</span>

echo &quot;Resizing <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span>&quot;
# Resize <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> in order to &quot;grow&quot; filesystem to user&#39;s selected size
e2fsck -f <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span>
resize2fs -p <span class="cp">${</span><span class="n">target_rootfs</span><span class="cp">}</span> 

#Set Ubuntu partition as top priority for next boot
cgpt add -i 6 -P 5 -T 1 <span class="cp">${</span><span class="n">target_disk</span><span class="cp">}</span> 
reboot
</pre></div>


<h2>参考</h2>
<p>1.http://www.chromium.org/chromium-os/developer-information-for-chrome-os-devices/samsung-series-5-chromebook   </p>
<p>2.https://github.com/dnschneid/crouton/wiki/Chromebook-Pixel</p>
<p>3.http://jeremyckahn.github.io/blog/2013/02/09/setting-up-a-local-development-environment-in-chrome-os/</p>
<p>4.http://virtuallyhyper.com/2013/03/install-chrubuntu-12-04-on-samsung-chromebook/</p>
<p>5.http://chromeos-cr48.blogspot.com/2012/10/arm-chrubuntu-1204-alpha-1-now.html</p></div>
		<div>
			<h2>Comments</h2>
		<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; hellok</p>
		</footer>
	  </div>

	</div>
</body>
</html>
